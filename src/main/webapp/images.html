<!DOCTYPE html>
<html>
<script type="text/javascript">

    const BUCKET = getUrlParamValue("bucket");
    const SCALE = getUrlParamValue("scale");
    const WIDTH = getUrlParamValue("width");
    const FORMAT = getUrlParamValue("format");

    if (!BUCKET) alert("No bucket provided");
   
    let headers = new Headers();
    headers.append("Accept", "application/json");

    let path = BUCKET;
    if(!path.endsWith("/")) path = path + "/";
    
    fetch(path + "?delimiter=/", {headers})
    .then(response => response.json())
    .then(value => {
        
        for(let dir of value) {
            dir = dir.subdir;
            if(dir) {
                let name = dir.substring(0, dir.lastIndexOf("."));
                let dzi = path + dir + name + ".dzi";
        		
                //SCALE rulz
                var url;
                if (WIDTH) url = window.location.origin + "/width/?dzi=" + dzi + "&width=" + WIDTH + "&format=" + FORMAT;
                if (SCALE) url = window.location.origin + "/scale/?dzi=" + dzi + "&scale=" + SCALE + "&format=" + FORMAT;
                
                var img = document.createElement('img');
                img.src = url;
                var container = document.getElementById("container");
                container.appendChild(img);
               
            }
        }
        //
        
    });
       
    function getUrlParamValue(paramName) {
        return (new URL(window.location)).searchParams.get(paramName);
    }

</script>
<body>

	<h2>Images (experimental)</h2>

	<div id="container"></div>

</body>
</html>







